<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora - DOM</title>
    <link rel="stylesheet" href="styles/reset.css">
    <link rel="stylesheet" href="styles/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.1.0/math.js"></script>
</head>
<body>
    <div class="container">
        <div class="content">
            <div class="display">
                <input id="display_numeros" type="text" readonly>
            </div>
            <div class="row">
                <button id="botao_limpar" aria-label="Limpar">C</button>
                <button aria-label="Mais ou menos">+/-</button>
                <button id="botao_porcentagem" aria-label="Porcentagem">%</button>
                <button id="botao_dividir" class="button__azul" aria-label="Divisão">/</button>
            </div>
            <div class="row">
                <button class="numero" id="botao_7" aria-label="Sete">7</button>
                <button class="numero" id="botao_8" aria-label="Oito">8</button>
                <button class="numero" id="botao_9" aria-label="Nove">9</button>
                <button id="botao_multiplicar" class="button__azul" aria-label="Multiplicação">x</button>
            </div>
            <div class="row">
                <button class="numero" id="botao_4" aria-label="Quatro">4</button>
                <button class="numero" id="botao_5" aria-label="Cinco">5</button>
                <button class="numero" id="botao_6" aria-label="Seis">6</button>
                <button id="botao_subtrair" class="button__azul" aria-label="Subtração">-</button>
            </div>
            <div class="row">
                <button class="numero" id="botao_1" aria-label="Um">1</button>
                <button class="numero" id="botao_2" aria-label="Dois">2</button>
                <button class="numero" id="botao_3" aria-label="Três">3</button>
                <button id="botao_somar" class="button__azul" aria-label="Adição">+</button>
            </div>
            <div class="row">
                <button aria-label="Ponto">.</button>
                <button class="numero" id="botao_0" aria-label="Zero">0</button>
                <button id="botao_raiz" arial-label="Raiz Quadrada">&radic;</button>
                <button id="igual" class="button__azul" aria-label="Igual">=</button>
            </div>                                                
        </div>
    </div>
    <script>
        const display = document.getElementById('display_numeros');
        let expressao = '';
        let operador = '';

        const atualizarDisplay = () => {
            display.value = expressao;
        }

        const adicionarAoDisplay = (valor) => {
            expressao += valor;
            atualizarDisplay();
        }    
        
        const limparDisplay = () => {
            expressao = '';
            atualizarDisplay();
        }

        const seletorDeOperacao = () => {
          try {
            expressao = math.evaluate(expressao).toString();
            atualizarDisplay();
            } catch (error) {
                console.error('Erro ao avaliar expressão:', error);
                expressao = 'Erro';
                atualizarDisplay();
        }
      }

        const calcularRaizQuadrada = () => {
          try {
            expressao = Math.sqrt(math.evaluate(expressao)).toString();
            atualizarDisplay();
            } catch (error) {
                console.error('Erro ao calcular raiz quadrada:', error);
                expressao = 'Erro';
                atualizarDisplay();
            }
        }

        const observarTeclado = (event) => { 
          const teclaPressionada = event.key;
            if (/^[0-9]+$/.test(teclaPressionada)) {
              adicionarAoDisplay(teclaPressionada);
            } else if (/^[+\-*/]$/.test(teclaPressionada)) {
                adicionarAoDisplay(teclaPressionada);
            } else if (teclaPressionada === 'Enter') {
                seletorDeOperacao();
            }
        }

        document.addEventListener('keydown', observarTeclado);
 
        const numeros = document.querySelectorAll('.numero');
        
        numeros.forEach(numero => {
            numero.addEventListener('click', () => {
                adicionarAoDisplay(numero.innerText);
            });
        });

        document.getElementById('botao_limpar').addEventListener('click', limparDisplay);
        document.getElementById('botao_somar').addEventListener('click', () => adicionarAoDisplay('+'));
        document.getElementById('botao_subtrair').addEventListener('click', () => adicionarAoDisplay('-'));
        document.getElementById('botao_multiplicar').addEventListener('click', () => adicionarAoDisplay('x'));
        document.getElementById('botao_dividir').addEventListener('click', () => adicionarAoDisplay('/'));
        document.getElementById('botao_porcentagem').addEventListener('click', () => adicionarAoDisplay('%'));
        document.getElementById('botao_raiz').addEventListener('click', calcularRaizQuadrada);
        document.getElementById('igual').addEventListener('click', seletorDeOperacao);
    </script>
</body>
</html>
